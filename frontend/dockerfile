# --- STAGE 1: The "Builder" ---
# This stage installs all dev dependencies and builds your app
FROM node:20-alpine AS builder

# Set the working directory
WORKDIR /app

# Copy the package lists
COPY package.json package-lock.json ./

# Install all dependencies (including dev dependencies)
RUN npm install

# Copy all your frontend code
COPY . .

# Run the production build
RUN npm run build

# --- STAGE 2: The "Runner" ---
# This stage creates the final, small image for production
FROM node:20-alpine

WORKDIR /app

# We don't need all the dev dependencies, just the final build artifacts.
# Copy the built app from the "builder" stage
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/public ./public
COPY --from=builder /app/package.json ./package.json
COPY --from=builder /app/node_modules ./node_modules

# Tell Docker your app runs on port 3000
EXPOSE 3000

# The command to start the production Next.js server
CMD ["npm", "start"]